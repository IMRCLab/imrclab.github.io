<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Wolfgang Hönig">
  <meta name="dcterms.date" content="2024-10-25">
  <title>Flying Robots</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4/dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="custom.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="media/title_dark.svg" data-background-size="contain">
  <h1 class="title">Flying Robots</h1>
  <p class="subtitle">Multirotor Flight Dynamics</p>
  <p class="author">Wolfgang Hönig</p>
  <p class="date">October 25, 2024</p>
</section>

<section>
<section id="introductions-reloaded" class="title-slide slide level1">
<h1>Introductions Reloaded</h1>

</section>
<section id="about-you" class="slide level2">
<h2>About You</h2>
<ol type="1">
<li>Field of Study</li>
<li>Robotics experience</li>
<li>Programming experience</li>
<li>Hopes/wishes for the course</li>
</ol>
</section></section>
<section>
<section id="assignment-0" class="title-slide slide level1">
<h1>Assignment 0</h1>

</section>
<section id="section" class="slide level2">
<h2></h2>
<div class="box-red">
<div class="box-red-title">
<p>Assignment 0: Build a 2D Multirotor Simulator</p>
</div>
<ul>
<li>Good way to learn Rust and see if you like the course.</li>
<li>Next week
<ul>
<li>Discussion/presentation of your solutions</li>
<li>Full 3D Multirotor dynamics and assignment 1</li>
</ul></li>
</ul>
</div>
<p>Did anyone attempt this?</p>
<p>Lets present/discuss results and challenges!</p>
</section></section>
<section>
<section id="basic-multirotor-flight-dynamics"
class="title-slide slide level1">
<h1>Basic Multirotor Flight Dynamics</h1>

</section>
<section id="motors-and-propellers" class="slide level2">
<h2>Motors and Propellers</h2>
<div class="container">
<div class="col">
<div class="box-def">
<div class="box-def-title">
<p>Brushed Motor</p>
</div>
<ul>
<li>Simple design</li>
<li>Cheap</li>
<li>Easy to control (e.g., pulse-width-modulation (<em>PWM</em>))</li>
</ul>
<p><img data-src="media/motor.webp" style="width:50.0%" /></p>
</div>
</div>
<div class="col">
<div class="box-def">
<div class="box-def-title">
<p>Brushless Motor</p>
</div>
<ul>
<li>More energy efficient</li>
<li>More durable</li>
<li>Controlled using an electronic speed controller (<em>ESC</em>)</li>
</ul>
</div>
</div>
</div>
<ul>
<li>We typically control the angular velocity of a motor <span
class="math inline">\(\omega_i\)</span> (in rpm)</li>
</ul>
</section>
<section id="motors-and-propellers-1" class="slide level2">
<h2>Motors and Propellers</h2>
<ul>
<li>Once we add a propeller, each motor/propeller creates a
<em>force</em> (upward) and <em>torque</em> (in the direction of
rotation)</li>
</ul>
<p><span class="math display">\[
\begin{align}
F_i &amp;= \kappa_F \omega_i^2\\
\tau_i &amp;= \kappa_\tau \omega_i^2
\end{align}
\]</span></p>
<ul>
<li>Both relate <em>quadratically</em> to <span
class="math inline">\(\omega_i\)</span></li>
<li><span class="math inline">\(\kappa_F\)</span> and <span
class="math inline">\(\kappa_\tau\)</span> are found through system
identification</li>
</ul>
</section>
<section id="frame" class="slide level2">
<h2>Frame</h2>
<ul>
<li>Motors are rigidly attached to a frame</li>
<li>Common: X-configuration or +-configuration (here: X)</li>
</ul>
<p><img data-src="media/cf2_props_dark.png" style="width:30.0%" /></p>
<div class="box-red">
<ul>
<li>Why do the motors spin in different directions?</li>
<li>Why do helicopters use two propellers?</li>
</ul>
</div>
</section>
<section id="force-allocation" class="slide level2">
<h2>Force Allocation</h2>
<ul>
<li>Mapping the control outputs (<span
class="math inline">\(\omega_i\)</span>) to the force <span
class="math inline">\(f\)</span> and body torque <span
class="math inline">\(\boldsymbol{\tau}=(\tau_x, \tau_y,
\tau_z)^\top\)</span> (acting on the center of mass)</li>
</ul>
<p><span class="math display">\[
\begin{align}
\boldsymbol{\eta} =
\begin{bmatrix}f\\\tau_x\\\tau_y\\\tau_z\end{bmatrix} = \mathbf B_0
\begin{bmatrix}\omega_1^2\\\vdots\\\omega_K^2\end{bmatrix}
\end{align}
\]</span></p>
<ul>
<li><span class="math inline">\(\mathbf B_0 \in \mathbb R^{4\times
K}\)</span> is the <em>allocation matrix</em></li>
</ul>
</section>
<section id="allocation-matrix-example-plus-configuration"
class="slide level2">
<h2>Allocation Matrix Example Plus-Configuration</h2>
<p><img data-src="media/coordinate_system_mellinger.png"
style="width:20.0%" /></p>
<p><span class="math display">\[
\begin{align}
\boldsymbol{\eta} =
\begin{bmatrix}f\\\tau_x\\\tau_y\\\tau_z\end{bmatrix} =
\begin{bmatrix}
\kappa_F &amp; \kappa_F &amp; \kappa_F &amp; \kappa_F\\
0 &amp; \kappa_F l &amp; 0 &amp; -\kappa_F l\\
-\kappa_F l &amp; 0 &amp; \kappa_F l &amp; 0\\
\kappa_\tau &amp; -\kappa_\tau &amp; \kappa_\tau &amp; -\kappa_\tau
\end{bmatrix}
\begin{bmatrix}
\omega_1^2\\
\omega_2^2\\
\omega_3^2\\
\omega_4^2
\end{bmatrix}
\end{align}
\]</span></p>
<ul>
<li><span class="math inline">\(l\)</span>: distance from the axis of
rotation of the rotors to the center of the quadrotor</li>
</ul>
<p>(From the seminal paper <span class="citation"
data-cites="mellingerMinimumSnapTrajectory2011">(Mellinger and Kumar
2011)</span>)</p>
</section>
<section id="reference-frame-crazyflie" class="slide level2">
<h2>Reference Frame Crazyflie</h2>
<p><img data-src="media/coordinate_system.jpg"
style="width:50.0%" /></p>
</section>
<section id="allocation-matrix-crazyflie" class="slide level2">
<h2>Allocation Matrix Crazyflie</h2>
<p><img data-src="media/cf2_props_dark.png" style="width:20.0%" /></p>
<p><span class="math display">\[
\begin{align}
\boldsymbol{\eta} =
\begin{bmatrix}f\\\tau_x\\\tau_y\\\tau_z\end{bmatrix} =
\begin{bmatrix}
\kappa_F &amp; \kappa_F &amp; \kappa_F &amp; \kappa_F\\
-\kappa_F a &amp; -\kappa_F a &amp; \kappa_F a &amp; \kappa_F a\\
-\kappa_F a &amp; \kappa_F a &amp; \kappa_F a &amp; -\kappa_F a\\
-\kappa_\tau &amp; \kappa_\tau &amp; -\kappa_\tau &amp; \kappa_\tau
\end{bmatrix}
\begin{bmatrix}
\omega_1^2\\
\omega_2^2\\
\omega_3^2\\
\omega_4^2
\end{bmatrix}
\end{align}
\]</span></p>
<ul>
<li><span class="math inline">\(a=\frac{l}{\sqrt{2}}\)</span></li>
</ul>
</section>
<section id="flight-dynamics" class="slide level2">
<h2>Flight Dynamics</h2>
<div class="container">
<div class="col">
<ul>
<li>State: <span class="math inline">\(\mathbf{x} = (\mathbf p, \mathbf
v, \mathbf R, \mathbf \omega)^\top \in \mathbb R^3 \times \mathbb R^3
\times SO(3) \times \mathbb R^3\)</span>
<ul>
<li>Position <span class="math inline">\(\mathbf p =
(x,y,z)^\top\)</span> [m, global frame]</li>
<li>Velocity <span class="math inline">\(\mathbf v = (\dot x, \dot y,
\dot z)^\top\)</span> [m/s, global frame]</li>
<li>Orientation <span class="math inline">\(\mathbf R\)</span> [attitude
rotation matrix]</li>
<li>Angular velocity <span class="math inline">\(\boldsymbol{\omega} =
(\omega_x, \omega_y, \omega_z)^\top\)</span> [rad/s, body frame]</li>
</ul></li>
<li>Action: <span class="math inline">\(\mathbf{u} = (f_1, f_2, f_3,
f_4) \in \mathbb R^4\)</span> [N]</li>
<li>Parameters
<ul>
<li>Mass <span class="math inline">\(m\)</span> [kg], Arm length <span
class="math inline">\(l\)</span> [m], inertia matrix <span
class="math inline">\(\mathbf J\)</span> [<span
class="math inline">\(kg\cdot m^2\)</span>], Gravity <span
class="math inline">\(g\)</span> [<span
class="math inline">\(m/s^2\)</span>]</li>
</ul></li>
</ul>
</div>
<div class="col">
<p><img data-src="media/cf2_props_dark.png" /></p>
</div>
</div>
</section>
<section id="flight-dynamics-1" class="slide level2">
<h2>Flight Dynamics</h2>
<div class="container">
<div class="col">
<ul>
<li>Dynamics: <span class="math display">\[
\begin{align}
  &amp;\dot{\mathbf{p}} = \mathbf{v}, &amp;&amp; m\mathbf{\dot{v}} =
m\mathbf{g} + \mathbf{R}\mathbf{f}_u,\\
  &amp;\dot{\mathbf{R}} = \mathbf{R}\boldsymbol{\hat{\omega}},
&amp;&amp;
  \mathbf{J}\dot{\boldsymbol{\omega}} =
\mathbf{J}\boldsymbol{\omega}\times \boldsymbol{\omega} +
\boldsymbol{\tau}_u,
\end{align}
\]</span> where</li>
<li><span class="math inline">\(\hat{\boldsymbol{\cdot}}\)</span>
denotes a skew-symmetric mapping <span class="math inline">\(\mathbb R^3
\rightarrow SO(3)\)</span></li>
<li><span class="math inline">\(\mathbf{g} = (0,0,-g)^\top\)</span> is
the gravity vector</li>
<li><span class="math inline">\(\boldsymbol{f}_u =
(0,0,f)^\top\)</span></li>
</ul>
</div>
<div class="col">
<p><img data-src="media/cf2_props_dark.png" /></p>
</div>
</div>
</section>
<section id="flight-dynamics-challenges" class="slide level2">
<h2>Flight Dynamics Challenges</h2>
<ul>
<li>What’s the “skew-symmetric mapping”?</li>
</ul>
<p><span class="math display">\[
\boldsymbol{\hat{\omega}} = \begin{bmatrix}
0 &amp; -\omega_z &amp; \omega_y\\
\omega_z &amp; 0 &amp; -\omega_x\\
-\omega_y &amp; \omega_x &amp; 0
\end{bmatrix}
\]</span></p>
<ul>
<li>Not every <span class="math inline">\(3\times 3\)</span> matrix is a
rotation matrix
<ul>
<li>needs to be orthogonal</li>
<li>needs to have determinant 1</li>
</ul></li>
</ul>
<div class="box-red">
<p>These properties need to be enforced after integration!</p>
</div>
</section>
<section id="rotation-representations" class="slide level2">
<h2>Rotation Representations</h2>
<ol type="1">
<li>Rotation Matrix</li>
</ol>
<div class="box-red">
<ul>
<li>Highly over-parameterized (9 entries for 3 rotations)</li>
</ul>
</div>
<ol start="2" type="1">
<li>Euler Angles</li>
</ol>
<div class="box-red">
<ul>
<li>Singularities that can cause a <a
href="https://en.wikipedia.org/wiki/Gimbal_lock">gimbal lock</a></li>
</ul>
</div>
<ol start="3" type="1">
<li>Quaternions</li>
</ol>
<div class="box-red">
<ul>
<li>Difficult to understand</li>
</ul>
</div>
</section>
<section id="quaternions" class="slide level2">
<h2>Quaternions</h2>
<ul>
<li>A <em>quaternion</em> is represented as <span
class="math inline">\(\mathbf q=(q_w, q_x, q_y, q_z)^\top=(q_w,
\vec{\mathbf q})^\top \in \mathbb R^4\)</span>
<ul>
<li>we denote <span class="math inline">\(\vec{\mathbf q}=(q_x, q_y,
q_z)\)</span></li>
<li>we <em>augment</em> a point <span class="math inline">\(\bar{\mathbf
r}\in\mathbb R^3\)</span>: <span class="math inline">\(\bar{\mathbf r} =
(0, \mathbf r)^\top\)</span></li>
</ul></li>
<li>For rotations we have <span class="math display">\[\mathbf
q=\begin{pmatrix} \cos(\theta/2)\\ \mathbf u \sin (\theta/2)
\end{pmatrix}\]</span>
<ul>
<li><span class="math inline">\(\theta\)</span> is the rotation
angle</li>
<li><span class="math inline">\(\mathbf u\in\mathbb R^3\)</span> is an
axis</li>
<li><span class="math inline">\(\| q \|_2 = 1\)</span> (<em>unit
quaternion</em> or <em>normalized quaternion</em>)</li>
</ul></li>
</ul>
</section>
<section id="quaternion-operations" class="slide level2">
<h2>Quaternion Operations</h2>
<ul>
<li><p>Negation: <span class="math display">\[
-\mathbf q = (-q_w, -q_x, -q_y, -q_z)^\top
\]</span></p></li>
<li><p>Addition: <span class="math display">\[
\mathbf q \oplus \mathbf p = (q_w + p_w, q_x + p_x, q_y + p_y, q_z +
p_z)^\top
\]</span></p></li>
<li><p>Multiplication: <span class="math display">\[
\mathbf q \otimes \mathbf p = \begin{pmatrix}
q_w p_w - q_x p_x - q_y p_y - q_z p_z\\
q_x p_w + q_w p_x - q_z p_y + q_y p_z\\
q_y p_w + q_z p_x + q_w p_y - q_x p_z\\
q_z p_w - q_y p_x + q_x p_y + q_w p_z
\end{pmatrix}
\]</span></p></li>
</ul>
</section>
<section id="quaternion-operations-1" class="slide level2">
<h2>Quaternion Operations</h2>
<ul>
<li><p>Conjugate <span class="math display">\[
\mathbf q^* = (q_w, -q_x, -q_y, -q_z)^\top
\]</span></p></li>
<li><p>Norm: regular <span class="math inline">\(L_2\)</span> norm on
the vector <span class="math display">\[
\| \mathbf q \| = \sqrt{q_w^2 + q_x^2 + q_y^2 + q_z^2}
\]</span></p></li>
</ul>
</section>
<section id="quaternion-vector-rotation" class="slide level2">
<h2>Quaternion Vector Rotation</h2>
<ul>
<li><p>With a rotation matrix <span class="math inline">\(\mathbf
R\)</span>, we can rotate a vector <span class="math inline">\(\mathbf
v\)</span> as <span class="math display">\[\mathbf v_{rotated} = \mathbf
R \mathbf v\]</span></p></li>
<li><p>With quaternion <span class="math inline">\(\mathbf q\)</span>
<span class="math display">\[
\overline{\mathbf v_{rotated}} = \mathbf q \odot \mathbf v = \mathbf q
\otimes \overline{\mathbf v} \otimes \mathbf q^*
\]</span></p></li>
</ul>
<p>(I.e., augment <span class="math inline">\(\mathbf v\)</span> to a
quaternion, use two quaternion multiplications, and one conjugate, and
then extract the vector part of the result)</p>
</section>
<section id="quaternion-derivative" class="slide level2">
<h2>Quaternion Derivative</h2>
<ul>
<li><p>Assuming <span class="math inline">\(\boldsymbol{\omega}\)</span>
in <em>body frame</em> (e.g., gyroscope): <span class="math display">\[
\dot{\mathbf q} = \frac{1}{2} \mathbf q
\otimes  \overline{\boldsymbol{\omega}}
\]</span></p></li>
<li><p>Assuming <span class="math inline">\(\boldsymbol{\omega}\)</span>
in <em>world frame</em> <span class="math display">\[
\dot{\mathbf q} = \frac{1}{2} \overline{\boldsymbol{\omega}} \otimes
\mathbf q
\]</span></p></li>
</ul>
<div class="box-ex">
<p>For integration, we can use Euler or RK4, but need to enforce <span
class="math inline">\(\| \mathbf q \|_2 = 1\)</span> afterwards.</p>
</div>
</section>
<section id="improved-quaternion-integration" class="slide level2">
<h2>Improved Quaternion Integration</h2>
<ul>
<li>A rotation starting from <span class="math inline">\(\mathbf
q_t\)</span> with fixed angular velocity <span
class="math inline">\(\boldsymbol{\omega}\)</span> (body frame) for a
(small) <span class="math inline">\(\Delta t\)</span></li>
</ul>
<p><span class="math display">\[
\mathbf q_{t+\Delta t} = \mathbf q_t \otimes \begin{pmatrix}
\cos{(\| \boldsymbol{\omega} \| \Delta t/2)}\\
\frac{\boldsymbol{\omega}}{\| \boldsymbol{\omega} \|}
\sin{(\|\boldsymbol{\omega}\| \Delta t/2)}
\end{pmatrix}
\]</span></p>
</section>
<section id="quaternion-references" class="slide level2">
<h2>Quaternion References</h2>
<p>More details and derivations at <span class="citation"
data-cites="2007-saerkkae-notesOnQuaternions 2024-jia-quaternions 2017-narayan-integrateQuaternions">(Särkkä
2007; Jia 2024; Narayan 2017)</span></p>
</section>
<section id="flight-dynamics-reloaded" class="slide level2">
<h2>Flight Dynamics Reloaded</h2>
<p><span class="math display">\[
\begin{align}
    &amp;\dot{\mathbf{p}} = \mathbf{v}, &amp;&amp; m\mathbf{\dot{v}} =
m\mathbf{g} + \mathbf{q} \odot (0, 0, f)^\top,\\
    &amp;\dot{\mathbf q} = \frac{1}{2} \mathbf q
\otimes  \overline{\boldsymbol{\omega}}, &amp;&amp;
    \mathbf{J}\dot{\boldsymbol{\omega}} =
\mathbf{J}\boldsymbol{\omega}\times \boldsymbol{\omega} +
\boldsymbol{\tau}_u,
\end{align}
\]</span> where <span class="math display">\[
\begin{align}
\begin{bmatrix}f\\\boldsymbol{\tau}_u\end{bmatrix} = \mathbf B_0
\begin{bmatrix}\omega_1^2\\\vdots\\\omega_K^2\end{bmatrix}
\end{align}
\]</span></p>
</section></section>
<section>
<section id="advanced-topics" class="title-slide slide level1">
<h1>Advanced Topics</h1>

</section>
<section id="system-identification" class="slide level2">
<h2>System Identification</h2>
<ul>
<li>mass <span class="math inline">\(m\)</span>, arm length <span
class="math inline">\(l\)</span>: scale, ruler</li>
<li>inertia <span class="math inline">\(\mathbf J\)</span>: often
estimated from CAD models</li>
<li>motor and propellers: trust stand
<ul>
<li>for forces, this can be a scale where the UAV is mounted upside
down</li>
<li><a
href="https://www.bitcraze.io/documentation/repository/crazyflie-firmware/master/functional-areas/pwm-to-thrust/#old-measurements-2015">Example
from 2015</a></li>
<li><a href="https://www.tytorobotics.com/pages/series-1580-1585">Modern
Commercial Thrust Stand</a></li>
</ul></li>
</ul>
<div class="box-ex">
<p>All important values were identified in a BS thesis <span
class="citation" data-cites="foersterbathesis">(Förster
2015)</span>.</p>
</div>
</section>
<section id="modeling-wind" class="slide level2">
<h2>Modeling Wind</h2>
<ul>
<li>In the dynamics, add an external force <span
class="math inline">\(\mathbf{f}_a\)</span>
<ul>
<li>might depend on time or location</li>
</ul></li>
</ul>
<p><span class="math display">\[
m\mathbf{\dot{v}} = m\mathbf{g} + \mathbf{q} \odot (0, 0, f)^\top +
\mathbf{f}_a(\mathbf p, t)
\]</span></p>
</section>
<section id="modeling-drag" class="slide level2">
<h2>Modeling Drag</h2>
<ul>
<li>In the dynamics, also add additional force <span
class="math inline">\(\mathbf{f}_a \propto \mathbf v\)</span> and torque
<span class="math inline">\(\boldsymbol{\tau}_a \propto
\boldsymbol{\omega}\)</span></li>
</ul>
</section>
<section id="rotor-placement" class="slide level2">
<h2>Rotor Placement</h2>
<div class="box-red">
<p>How many controllable degrees-of-freedom does a Quadrotor (like the
Crazyflie) have?</p>
</div>
<div class="fragment">
<ul>
<li>If we place motors not in a single plane, we can control orientation
while staying in place
<ul>
<li><em>Fully actuated</em> UAV <span class="citation"
data-cites="2020-rashad-FullyActuatedMultirotor">(Rashad et al.
2020)</span></li>
<li>downside: less energy-efficient</li>
</ul></li>
</ul>
<p><img data-src="media/fully-actuated.png" style="width:50.0%" /></p>
</div>
</section>
<section id="dynamics-learning" class="slide level2">
<h2>Dynamics Learning</h2>
<ul>
<li>Difficult to model everthing
<ul>
<li>ground effect: a force when hovering close to the ground</li>
<li>interaction forces: forces when two UAVs are in close (vertical)
proximity</li>
</ul></li>
<li>Typical approach:
<ol type="1">
<li>Collect data</li>
<li>Use supervised learning to train (<em>residual</em>) models</li>
</ol></li>
</ul>
<p>Examples: <span class="citation"
data-cites="bauersfeldNeuroBEMHybridAerodynamic2021 2022-shi-NeuralSwarm2PlanningControl smithEquivariantDownwashModels2023">(Bauersfeld
et al. 2021; Shi et al. 2022; Smith et al. 2023)</span></p>
</section>
<section id="existing-simulators" class="slide level2">
<h2>Existing Simulators</h2>
<ul>
<li>Many: recent survey lists 44 <span class="citation"
data-cites="2024-dimmig-SurveySimulatorsAerial">(Dimmig et al.
2024)</span>
<ul>
<li>Some are generic robotics simulators (Gazebo, MuJoCo, Webots, Isaac
Sim)</li>
<li>Some are highly specialized (e.g., for training RL agents)</li>
</ul></li>
</ul>
<div class="fragment">
<div class="box-ex">
<p>To understand how a robot works <span
class="math inline">\(\Rightarrow\)</span> build your own, like in this
class.</p>
<p>For practical use-cases: use one of the existing ones (guidelines:
see survey paper).</p>
</div>
</div>
</section></section>
<section>
<section id="assignment-1" class="title-slide slide level1">
<h1>Assignment 1</h1>

</section>
<section id="task" class="slide level2">
<h2>Task</h2>
<p>The goal of this assignment is to build a dynamics simulator for the
Bitcraze Crazyflie 2.1 robot. This simulator will be extended in the
upcoming assignments to test controls, state estimation, and motion
planning.</p>
</section>
<section id="experiment-on-simulation-quality" class="slide level2">
<h2>Experiment on Simulation Quality</h2>
<p>Compare (runtime/step size/solution quality) of two different
integration schemes you have learned. Options:</p>
<ol type="1">
<li>Pure Euler integration,</li>
<li>Pure RK4 integration,</li>
<li>Exponential map for quaternion integration, Euler otherwise</li>
<li>Exponential map for quaternion integration, RK4 otherwise</li>
</ol>
</section>
<section id="dynamics-validation" class="slide level2">
<h2>Dynamics Validation</h2>
<p>Given: state and action sequence of a sample flight.</p>
<p>Goal: Verify that the dynamics are correct.</p>
<div class="box-red">
<p>Integrating over the whole trajectory does not work, as small
numerical differences can lead to largely different results.</p>
</div>
<div class="box-ex">
<p>Integrate over <span class="math inline">\(k=1...10\)</span>
time-steps, and compare the simulated states and real states
instead.</p>
</div>
</section>
<section id="rust-hint-operator-overloading" class="slide level2">
<h2>Rust Hint: Operator Overloading</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::ops::</span><span class="bu">Add</span><span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Vec3 <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">:</span> <span class="dt">f32</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">:</span> <span class="dt">f32</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    z<span class="op">:</span> <span class="dt">f32</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="bu">Add</span> <span class="cf">for</span> Vec3 <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> Output <span class="op">=</span> <span class="dt">Self</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> add(<span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="dt">Self</span>) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            x<span class="op">:</span> <span class="kw">self</span><span class="op">.</span>x <span class="op">+</span> other<span class="op">.</span>x<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            y<span class="op">:</span> <span class="kw">self</span><span class="op">.</span>y <span class="op">+</span> other<span class="op">.</span>y<span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            z<span class="op">:</span> <span class="kw">self</span><span class="op">.</span>z <span class="op">+</span> other<span class="op">.</span>z<span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> a <span class="op">=</span> Vec3 <span class="op">{</span>x<span class="op">:</span> <span class="dv">0.0</span><span class="op">,</span> y<span class="op">:</span> <span class="dv">1.0</span><span class="op">,</span> z<span class="op">:</span> <span class="dv">2.0</span><span class="op">};</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> b <span class="op">=</span> Vec3 <span class="op">{</span>x<span class="op">:</span> <span class="dv">3.0</span><span class="op">,</span> y<span class="op">:</span> <span class="dv">4.0</span><span class="op">,</span> z<span class="op">:</span> <span class="dv">5.0</span><span class="op">};</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> c <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;{:?}&quot;</span><span class="op">,</span> c)<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section></section>
<section>
<section id="conclusion" class="title-slide slide level1">
<h1>Conclusion</h1>

</section>
<section id="learned-today" class="slide level2">
<h2>Learned Today</h2>
<ul>
<li>Multirotor <em>dynamics</em></li>
<li>Efficient and numerically stable handling of rotations via
<em>quaternions</em></li>
<li>Outline of Assignment 1</li>
</ul>
<div class="box-ex">
<div class="box-ex-title">
<p>Next Week</p>
</div>
<p>Discussion session: bring your code and any questions!</p>
</div>
<div class="box-red">
<div class="box-red-title">
<p>Official Registration</p>
</div>
<p>On MOSES until Nov 1st (midnight).</p>
</div>
</section>
<section id="references-suggested-reading" class="slide level2">
<h2>References / Suggested Reading</h2>
<div id="refs" class="references csl-bib-body hanging-indent"
data-entry-spacing="0" role="list">
<div id="ref-bauersfeldNeuroBEMHybridAerodynamic2021" class="csl-entry"
role="listitem">
Bauersfeld, Leonard, Elia Kaufmann, Philipp Foehn, Sihao Sun, and Davide
Scaramuzza. 2021. <span>“NeuroBEM: Hybrid Aerodynamic Quadrotor
Model.”</span> In. Vol. 17. <a
href="https://www.roboticsproceedings.org/rss17/p042.html">https://www.roboticsproceedings.org/rss17/p042.html</a>.
</div>
<div id="ref-2024-dimmig-SurveySimulatorsAerial" class="csl-entry"
role="listitem">
Dimmig, Cora A., Giuseppe Silano, Kimberly McGuire, Chiara Gabellieri,
Wolfgang Hönig, Joseph Moore, and Marin Kobilarov. 2024. <span>“Survey
of Simulators for Aerial Robots: An Overview and in-Depth Systematic
Comparisons.”</span> <em>IEEE Robotics &amp; Automation Magazine</em>,
2–15. <a
href="https://doi.org/10.1109/MRA.2024.3433171">https://doi.org/10.1109/MRA.2024.3433171</a>.
</div>
<div id="ref-foersterbathesis" class="csl-entry" role="listitem">
Förster, Julian. 2015. <span>“System Identification of the Crazyflie 2.0
Nano Quadrocopter.”</span> Bachelor’s thesis, ETH Zurich. <a
href="https://www.research-collection.ethz.ch/handle/20.500.11850/214143">https://www.research-collection.ethz.ch/handle/20.500.11850/214143</a>.
</div>
<div id="ref-2024-jia-quaternions" class="csl-entry" role="listitem">
Jia, Prof. Yan-Bin. 2024. <span>“Quaternions (Com s 477/577
Notes).”</span> 2024. <a
href="https://faculty.sites.iastate.edu/jia/files/inline-files/quaternion.pdf">https://faculty.sites.iastate.edu/jia/files/inline-files/quaternion.pdf</a>.
</div>
<div id="ref-mellingerMinimumSnapTrajectory2011" class="csl-entry"
role="listitem">
Mellinger, Daniel, and Vijay Kumar. 2011. <span>“Minimum Snap Trajectory
Generation and Control for Quadrotors.”</span> In <em>2011 IEEE
International Conference on Robotics and Automation</em>, 2520–25. <a
href="https://doi.org/10.1109/ICRA.2011.5980409">https://doi.org/10.1109/ICRA.2011.5980409</a>.
</div>
<div id="ref-2017-narayan-integrateQuaternions" class="csl-entry"
role="listitem">
Narayan, Dr. Ashwin. 2017. <span>“How to Integrate Quaternions.”</span>
2017. <a
href="https://www.ashwinnarayan.com/post/how-to-integrate-quaternions/">https://www.ashwinnarayan.com/post/how-to-integrate-quaternions/</a>.
</div>
<div id="ref-2020-rashad-FullyActuatedMultirotor" class="csl-entry"
role="listitem">
Rashad, Ramy, Jelmer Goerres, Ronald Aarts, Johan B. C. Engelen, and
Stefano Stramigioli. 2020. <span>“Fully Actuated Multirotor UAVs: A
Literature Review.”</span> <em>IEEE Robotics &amp; Automation
Magazine</em> 27 (3): 97–107. <a
href="https://doi.org/10.1109/MRA.2019.2955964">https://doi.org/10.1109/MRA.2019.2955964</a>.
</div>
<div id="ref-2007-saerkkae-notesOnQuaternions" class="csl-entry"
role="listitem">
Särkkä, Prof. Simo. 2007. <span>“Notes on Quaternions.”</span> 2007. <a
href="https://users.aalto.fi/~ssarkka/pub/quat.pdf">https://users.aalto.fi/~ssarkka/pub/quat.pdf</a>.
</div>
<div id="ref-2022-shi-NeuralSwarm2PlanningControl" class="csl-entry"
role="listitem">
Shi, Guanya, Wolfgang Honig, Xichen Shi, Yisong Yue, and Soon-Jo Chung.
2022. <span>“Neural-Swarm2: Planning and Control of Heterogeneous
Multirotor Swarms Using Learned Interactions.”</span> <em>IEEE
Transactions on Robotics</em> 38 (2): 1063–79. <a
href="https://doi.org/10.1109/TRO.2021.3098436">https://doi.org/10.1109/TRO.2021.3098436</a>.
</div>
<div id="ref-smithEquivariantDownwashModels2023" class="csl-entry"
role="listitem">
Smith, H., A. Shankar, J. Blumenkamp, J. Gielis, and A. Prorok. 2023.
<span>“SO(2)-Equivariant Downwash Models for Close Proximity
Flight.”</span> May 30, 2023. <a
href="http://arxiv.org/abs/2305.18983">http://arxiv.org/abs/2305.18983</a>.
</div>
</div>
</section>
<section id="questions" class="slide level2">
<h2>Questions</h2>
<div class="r-fit-text">
<p>?</p>
</div>
</section></section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4/plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4/plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4/plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4/plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.2,

        maxScale: 10,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [
          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
